<div class="project-tasks-container">

  <!-- HEADER -->
  <div class="tasks-header">

    <div class="header-left">
      <button mat-icon-button class="back-btn" (click)="goBack()">
        <mat-icon>arrow_back</mat-icon>
      </button>

      <div>
        <h1>{{ projectName() }}</h1>
        <span class="subtitle">Gestión de tareas del proyecto</span>
      </div>
    </div>

    <button mat-flat-button color="primary" (click)="navigateToNewTask()">
      <mat-icon>add</mat-icon>
      Nueva tarea
    </button>

  </div>

  <!-- KPI MINI (opcional pero poderoso) -->
  <div class="mini-kpi" *ngIf="!loading()">

    <mat-card>
      <p>Total</p>
      <h2>{{ totalItems() }}</h2>
    </mat-card>

    <mat-card>
      <p>Completadas</p>
      <h2>{{ completedCount() }}</h2>
    </mat-card>

    <mat-card>
      <p>Pendientes</p>
      <h2>{{ totalItems() - completedCount() }}</h2>
    </mat-card>

  </div>

  <!-- GRÁFICO -->
  <mat-card class="chart-card" *ngIf="!loading() && chartData().length">
    <mat-card-header>
      <mat-card-title>
        <mat-icon>pie_chart</mat-icon>
        Distribución de tareas
      </mat-card-title>
    </mat-card-header>

    <mat-card-content>
      <app-task-status-chart [data]="chartData()"></app-task-status-chart>
    </mat-card-content>
  </mat-card>

  <!-- ERROR -->
  <div *ngIf="error()" class="error-message">
    <mat-icon>error</mat-icon>
    <p>{{ error() }}</p>
    <button mat-stroked-button color="warn" (click)="loadTasks()">Reintentar</button>
  </div>

  <!-- FILTROS -->
  <mat-card class="filters-card">
    <app-task-filters
      [developers]="developers()"
      (filtersChange)="onFiltersChange($event)">
    </app-task-filters>
  </mat-card>

  <!-- TABLA -->
  <app-loading-spinner *ngIf="loading()"></app-loading-spinner>

  <mat-card *ngIf="!loading() && tasks().length">
    <app-data-table
      [columns]="taskColumns"
      [data]="tasks()"
      (rowClick)="onTaskClick($event)">
    </app-data-table>
  </mat-card>

  <!-- PAGINADOR -->
  <div class="paginator-container"
       *ngIf="!loading() && tasks().length">

    <app-paginator
      [totalItems]="totalItems()"
      [pageSize]="pageSize()"
      [currentPage]="currentPage()"
      (pageChange)="onPageChange($event)">
    </app-paginator>

  </div>

</div>
